@page
@model Gestion_Restaurant.Pages.Commandes.EditModel

@{
    ViewData["Title"] = "Edit";
}

<h1>Edit</h1>

<h4>Commande</h4>
<hr />
<form method="post">
    <div class="row">
        <div class="col-md-4">
            <input asp-for="Commande.CommandeServiPar" type="hidden" />
            <input asp-for="Commande.CommandePreparerPar" type="hidden" />
            <input asp-for="Commande.CommandeProduits" type="hidden" />
            <input asp-for="Commande.CommandeTables" type="hidden" />
            <input asp-for="Commande.Id" type="hidden" />


            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group">
                <label asp-for="Commande.Statut" class="control-label"></label>
                <select asp-for="Commande.Statut" class="form-control">
                    <option value="En préparation">En préparation</option>
                    <option value="Prête">Prête</option>
                    <option value="Servie">Servie</option>
                </select>
                <span asp-validation-for="Commande.Statut" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label class="control-label">Barmen</label>
                <select asp-for="BarmenIds" class="form-control" asp-items="ViewBag.BarmanId"></select>
            </div>
            <div class="form-group">
                <label class="control-label">Serveurs</label>
                <select asp-for="ServeursIds" class="form-control" asp-items="ViewBag.ServeurId"></select>
            </div>
            <div class="form-group">
                <label class="control-label">Table</label>
                <select asp-for="TablesIds" class="form-control" asp-items="ViewBag.TableId"></select>
            </div>

            <div class="form-group mt-3">
                <input type="submit" value="Modifier" class="btn btn-primary" />
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group" id="produits">
                <label class="control-label">Produit(s)</label>
                <select id="produit" name="produits" class="form-control" asp-items="ViewBag.ProduitId"></select>
            </div>
        </div>
        <div class="col-md-3 mt-2 ps-0" id="buttonsProduit">
            <div class="mt-3">
                <a class="btn btn-primary" id="addProduit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                    </svg>
                </a>
                <div class="mt-2 d-none" id="removeProduit">
                    <a class="btn btn-danger">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash" viewBox="0 0 16 16">
                            <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>
</form>

<select multiple class="form-control d-none" id="produitsSelected" asp-items="ViewBag.ProduitId"></select>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        var compteur = 0
        $('#addProduit').click(addProduit)
        $("#produitsSelected option").each(function(){
            if($(this).attr('selected') === "selected")
            {
                if(compteur === 0)
                {
                    $('#produit').val($(this).val())
                    compteur++;
                }
                else{
                    addProduit($(this).val())
                }
            }
        })

        function addProduit(valeur) {
            compteur = compteur + 1
            $('#produit').clone().appendTo("#produits").addClass('mt-2').attr('id', 'produits_' + compteur)
            $('#removeProduit').clone().appendTo("#buttonsProduit").removeClass('d-none').addClass('produits_' + compteur).click(removeProduit)
            if(typeof valeur === 'string'){
                $('#produits_' + compteur + ' option').removeAttr('selected')
                $('#produits_'+compteur).val(valeur)
            }
        }
        function removeProduit() {
            $('#' + $(this).attr('class').split(' ')[1]).remove()
            $(this).remove()
        }
    </script>
}
